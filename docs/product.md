# Silver Lantern - プロダクト定義

## 1. 課題選定

### 「SNSで解決されがちだけど面倒」な課題 10個

| # | 課題 | 現状の解決法 | 面倒な点 |
|---|------|-------------|---------|
| 1 | **割り勘計算** | LINEグループで手計算 | 誰が誰にいくら払うか複雑、履歴が流れる |
| 2 | **予定調整** | LINEアンケートやDM | 候補日が多いと把握困難、変更追跡不可 |
| 3 | **買い物リスト共有** | LINEで「○○買って」 | メッセージ埋もれ、買ったかどうか不明 |
| 4 | **貸し借り記録** | 口頭やLINEで「後で返す」 | 忘れる、金額不一致、催促しづらい |
| 5 | **ウィッシュリスト共有** | SNS投稿「これ欲しい」 | プレゼント被り、後から探しにくい |
| 6 | **グループ内投票** | LINEスタンプやリアクション | 選択肢管理困難、集計面倒 |
| 7 | **持ち寄りパーティ管理** | グループチャットで宣言 | 被り確認、当日忘れ、変更追跡 |
| 8 | **読書・映画の感想共有** | Twitterに投稿 | 散らばる、後で振り返りにくい |
| 9 | **ルーティン/習慣トラッカー** | ツイートで「今日も○○した」 | 連続記録が見えない、振り返り困難 |
| 10 | **もらい物・贈り物記録** | 記憶頼み or メモ帳 | 誰から何をもらったか忘れる、お返し管理 |

### スコアリング (各5点満点)

**評価基準:**
- **A. 技術的実現性** — 静的MVPで実現可能か（SSR不要、クライアントサイドのみ）
- **B. ユーザー価値** — 解決した時のインパクト（多くの人が実際に困っているか）
- **C. スコープ制御** — 3画面・1フローに収まるか
- **D. Firebase適合度** — Auth + Firestoreで自然に実装できるか（CRUDが1リソースで完結）
- **E. 差別化可能性** — 既存SNS機能との差別化（デモ映え含む）

| # | 課題 | A | B | C | D | E | 合計 |
|---|------|---|---|---|---|---|------|
| 1 | 割り勘計算 | 4 | 5 | 3 | 3 | 4 | 19 |
| 2 | 予定調整 | 4 | 5 | 2 | 3 | 3 | 17 |
| 3 | 買い物リスト共有 | 5 | 4 | 5 | 5 | 4 | 23 |
| 4 | 貸し借り記録 | 5 | 4 | 4 | 5 | 4 | 22 |
| 5 | ウィッシュリスト共有 | 5 | 3 | 4 | 5 | 3 | 20 |
| 6 | グループ内投票 | 4 | 3 | 3 | 3 | 3 | 16 |
| 7 | 持ち寄り管理 | 4 | 2 | 4 | 4 | 3 | 17 |
| 8 | 感想共有 | 5 | 3 | 4 | 4 | 3 | 19 |
| 9 | 習慣トラッカー | 5 | 4 | 5 | 5 | 5 | **24** |
| 10 | もらい物記録 | 5 | 3 | 4 | 5 | 3 | 20 |

### 最終選定: **習慣トラッカー** (スコア 24/25)

**選定理由:**
1. **ユーザーニーズ**: SNSで「今日も○○した」と投稿するのは面倒だが記録したいニーズがある。Habitica, Streaks等の人気アプリが市場を検証済み
2. **静的MVP完全適合**: クライアントサイドでFirestore操作のみ、SSR不要
3. **CRUDが最もクリーン**: 習慣(Habit)の作成・読取・更新・削除が1リソースで完結
4. **3画面で十分**: ログイン → ダッシュボード(今日のチェック) → 習慣管理
5. **差別化**: シンプルなチェック式で記録でき、ストリーク表示でモチベーション維持。SNSのタイムライン型とは根本的に異なるUI

---

## 2. 解決策

### コンセプト

**Silver Lantern** — 「今日やるべきことをチェックするだけ」のシンプル習慣トラッカー

毎日の小さな習慣をチェックボックスで記録し、連続達成日数（ストリーク）を可視化することで、ゲーミフィケーション無しでもモチベーションを維持できるミニマルなアプリ。

### ターゲットユーザー

- 習慣を身につけたいが、既存アプリが複雑すぎると感じている人
- SNSに「今日も○○した」と投稿するのは面倒だが、記録は残したい人
- シンプルなチェックリストで十分な人

### 差別化ポイント

| 比較軸 | SNS (Twitter等) | 大型習慣アプリ (Habitica等) | Silver Lantern |
|--------|-----------------|---------------------------|----------------|
| 記録方法 | テキスト投稿 | 複雑なUI | ワンタップチェック |
| 振り返り | タイムラインを遡る | ダッシュボード多数 | ストリーク表示のみ |
| セットアップ | 不要 | 長い初期設定 | Google認証のみ |
| 他者の目 | 公開前提 | ソーシャル機能あり | 完全プライベート |

---

## 3. 主要フロー

```
┌─────────────┐     Google認証     ┌──────────────────┐
│  ログイン画面  │ ──────────────→ │  ダッシュボード    │
│  (/)         │                   │  (/dashboard)     │
└─────────────┘                   │                    │
                                   │  - 今日の日付表示   │
                                   │  - 習慣チェック     │
                                   │  - ストリーク表示   │
                                   │                    │
                                   │  [習慣を管理] →     │
                                   └────────┬───────────┘
                                            │
                                            ↓
                                   ┌──────────────────┐
                                   │  習慣管理画面      │
                                   │  (/habits)        │
                                   │                    │
                                   │  - 習慣の追加      │
                                   │  - 習慣の削除      │
                                   │  - 一覧表示        │
                                   │                    │
                                   │  [戻る] →          │
                                   └──────────────────┘
```

**メインフロー (日常利用):**
1. アプリを開く → 認証済みならダッシュボードへ自動遷移
2. 今日の習慣一覧が表示される
3. 完了した習慣のチェックボックスをタップ
4. ストリーク(連続日数)がリアルタイム更新

**初回フロー:**
1. ログイン画面で「Googleでログイン」をクリック
2. ダッシュボードに遷移（習慣が空の状態）
3. 「習慣を管理」リンクから習慣管理画面へ
4. 習慣名を入力して追加
5. ダッシュボードに戻ってチェック開始

---

## 4. データモデル (Firestore)

```
Firestore
└── users (collection)
    └── {userId} (document - 暗黙的)
        └── habits (subcollection)
            └── {habitId} (document)
                ├── name: string          // 習慣名 (例: "朝のジョギング")
                ├── createdAt: timestamp  // 作成日時 (orderBy用)
                │
                └── logs (subcollection)
                    └── {dateStr} (document)  // 例: "2026-02-25"
                        ├── done: boolean     // 完了フラグ
                        └── date: string      // "YYYY-MM-DD" 形式
```

**設計判断:**
- `users/{userId}` 以下にデータを完全分離 → セキュリティルールがシンプル
- `logs` をサブコレクションにすることで、日付ごとのクエリが効率的
- `dateStr` をドキュメントIDに使用 → 同一日の重複防止、直接参照が可能
- ストリーク計算はクライアントサイドで直近のlogsから算出

### Firestore Security Rules

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId}/habits/{habitId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      match /logs/{logId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

認証済みユーザーが自分のデータのみアクセス可能。それ以外のパスは全て拒否。

---

## 5. 画面構成

### 画面1: ログイン画面 (`/` — `app/page.tsx`)

| 要素 | 説明 |
|------|------|
| アプリ名 | "Silver Lantern" |
| タグライン | "今日やるべきことをチェックするだけ。シンプルな習慣トラッカー。" |
| ログインボタン | "Googleでログイン" (Firebase Auth `signInWithPopup`) |
| 自動遷移 | 認証済みの場合 `/dashboard` へリダイレクト |
| エラー表示 | ログイン失敗時にメッセージ表示 |

### 画面2: ダッシュボード (`/dashboard` — `app/dashboard/page.tsx`)

| 要素 | 説明 |
|------|------|
| ヘッダー | アプリ名 + ログアウトボタン (`components/Header.tsx`) |
| 日付表示 | 今日の日付（日本語フォーマット: 2026年2月25日(水)） |
| 習慣リスト | チェックボックス + 習慣名 + ストリーク表示 |
| 空状態 | "習慣がまだありません。まずは習慣を追加しましょう！" |
| 管理リンク | "習慣を管理" → `/habits` へ遷移 |
| 認証ガード | 未認証の場合 `/` へリダイレクト (`components/AuthGuard.tsx`) |

### 画面3: 習慣管理 (`/habits` — `app/habits/page.tsx`)

| 要素 | 説明 |
|------|------|
| ヘッダー | アプリ名 + ログアウトボタン |
| 見出し | "習慣管理" |
| 追加フォーム | テキスト入力 + "追加"ボタン |
| 習慣一覧 | 習慣名 + "削除"ボタン |
| 空状態 | "習慣がまだありません。" |
| 戻るリンク | "ダッシュボードへ戻る" → `/dashboard` へ遷移 |
| 認証ガード | 未認証の場合 `/` へリダイレクト |

### 共通コンポーネント

| コンポーネント | 役割 |
|---------------|------|
| `AuthGuard` | 認証状態の監視、未認証時のリダイレクト、ローディング表示 |
| `Header` | アプリ名とログアウトボタンの共通ヘッダー |

---

## 6. 技術スタック

| レイヤー | 技術 | バージョン |
|---------|------|-----------|
| フレームワーク | Next.js (App Router, static export) | 16.1.x |
| UI ライブラリ | React | 19.2.x |
| 言語 | TypeScript (strict) | 5.9.x |
| 認証 | Firebase Auth (Google provider) | 12.9.x |
| データベース | Cloud Firestore | 12.9.x |
| ホスティング | Firebase Hosting | - |
| スタイリング | CSS Modules | - |
| E2Eテスト | Playwright | 1.58.x |
| リンター | ESLint + eslint-config-next | 9.39.x |

---

## 7. MVPスコープと将来拡張

### MVP (現在のスコープ)

- [x] Google認証によるログイン/ログアウト
- [x] 習慣の追加・削除 (CRUD)
- [x] 今日の習慣チェック (done/undone トグル)
- [x] 連続達成日数 (ストリーク) の表示
- [x] 認証ガードによるルート保護
- [x] リアルタイム同期 (Firestore `onSnapshot`)
- [x] Firestoreセキュリティルール (ユーザーごとのデータ分離)

### 将来拡張 (未実装)

| 優先度 | 機能 | 概要 |
|--------|------|------|
| 高 | 習慣の編集 | 習慣名の変更 |
| 高 | カレンダー表示 | 月次の達成状況を一覧 |
| 中 | カテゴリ分類 | 習慣をカテゴリでグルーピング |
| 中 | リマインダー通知 | PWA push notification |
| 中 | 統計・グラフ | 週次/月次の達成率グラフ |
| 低 | データエクスポート | CSV/JSON形式でのバックアップ |
| 低 | テーマ切替 | ダークモード対応 |
| 低 | 共有機能 | 友人との習慣共有・チャレンジ |
